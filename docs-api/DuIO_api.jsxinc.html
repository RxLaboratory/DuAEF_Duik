

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> DuIO_api.jsxinc</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="jsdoc.css">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item">Duik API Reference</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://rxlaboratory.org/tools/duik"
                        >
                            Website
                        </a>
                    
                        <a
                            class="link user-link "
                            href="https://github.com/RxLaboratory/Duik"
                        >
                            Source code
                        </a>
                    
                        <a
                            class="link user-link "
                            href="http://duik.rxlab.guide"
                        >
                            User guide
                        </a>
                    
                        <a
                            class="link user-link "
                            href="http://donate.rxlab.info"
                        >
                            Donate
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Namespaces</h3><ul><li><a href="Duik.CmdLib._Tool_.html">"Tool"</a></li><li><a href="Duik.CmdLib._Auto-rig_.html">'Auto-rig'</a></li><li><a href="Duik.CmdLib._Automation_.html">'Automation'</a></li><li><a href="Duik.CmdLib._Bone_.html">'Bone'</a></li><li><a href="Duik.CmdLib._Camera_.html">'Camera'</a></li><li><a href="Duik.CmdLib._Constraint_.html">'Constraint'</a></li><li><a href="Duik.CmdLib._Controller_.html">'Controller'</a></li><li><a href="Duik.CmdLib._Layer_.html">'Layer'</a></li></ul><h3>Classes</h3><ul><li><a href="DuVector.html">DuVector</a></li></ul><h3>Global</h3><ul><li><a href="global.html#i18n">i18n</a></li></ul></div><div class="category"><h2>DuAEF</h2><h3>Namespaces</h3><ul><li><a href="DuAE.html">DuAE</a></li><li><a href="DuAEComp.html">DuAEComp</a></li><li><a href="DuAEExpression.html">DuAEExpression</a></li><li><a href="DuAEExpression.Library.html">Library</a></li><li><a href="DuAEF.html">DuAEF</a></li><li><a href="DuAEItem.html">DuAEItem</a></li><li><a href="DuAELayer.html">DuAELayer</a></li><li><a href="DuAEProject.html">DuAEProject</a></li><li><a href="DuAEProjectXMP.html">DuAEProjectXMP</a></li><li><a href="DuAEPuppet.html">DuAEPuppet</a></li><li><a href="DuAERenderQueue.html">DuAERenderQueue</a></li><li><a href="DuAEShapeLayer.html">DuAEShapeLayer</a></li><li><a href="DuAETag.html">DuAETag</a></li><li><a href="DuAEUI.html">DuAEUI</a></li></ul><h3>Classes</h3><ul><li><a href="DuAEKeyframe.html">DuAEKeyframe</a></li><li><a href="DuAEKeySpatialProperties.html">DuAEKeySpatialProperties</a></li><li><a href="DuAELayerAnimation.html">DuAELayerAnimation</a></li><li><a href="DuAEProperty.html">DuAEProperty</a></li><li><a href="DuAEPropertyAnimation.html">DuAEPropertyAnimation</a></li><li><a href="DuAEPropertyExpression.html">DuAEPropertyExpression</a></li><li><a href="DuAEPropertyGroupAnimation.html">DuAEPropertyGroupAnimation</a></li><li><a href="DuAEPseudoEffect.html">DuAEPseudoEffect</a></li></ul></div><div class="category"><h2>DuESF</h2><h3>Namespaces / Third Party</h3><ul><li><a href="Base64.html">Base64</a></li><li><a href="JSON.html">JSON</a></li></ul><h3>Namespaces</h3><ul><li><a href="DuDate.html">DuDate</a></li><li><a href="DuDebug.html">DuDebug</a></li><li><a href="DuESF.html">DuESF</a></li><li><a href="DuFile.html">DuFile</a></li><li><a href="DuFolder.html">DuFolder</a></li><li><a href="DuInterpolation.html">DuInterpolation</a></li><li><a href="DuJSObj.html">DuJSObj</a></li><li><a href="DuMath.html">DuMath</a></li><li><a href="DuNumber.html">DuNumber</a></li><li><a href="DuPath.html">DuPath</a></li><li><a href="DuRegExp.html">DuRegExp</a></li><li><a href="DuString.html">DuString</a></li><li><a href="DuSystem.html">DuSystem</a></li><li><a href="DuURL.html">DuURL</a></li><li><a href="DuXML.html">DuXML</a></li><li><a href="DuXMP.html">DuXMP</a></li><li><a href="DuZip.html">DuZip</a></li><li><a href="YAML.html">YAML</a></li></ul><h3>Classes / Third Party</h3><ul><li><a href="colorPicker.html">colorPicker</a></li><li><a href="Matrix.html">Matrix</a></li></ul><h3>Classes</h3><ul><li><a href="DuBinary.html">DuBinary</a></li><li><a href="DuColor.html">DuColor</a></li><li><a href="DuDebugLog.html">DuDebugLog</a></li><li><a href="DuList.html">DuList</a></li><li><a href="DuProcess.html">DuProcess</a></li><li><a href="DuProcessQueue.html">DuProcessQueue</a></li><li><a href="DuSettings.html">DuSettings</a></li><li><a href="DuVersion.html">DuVersion</a></li></ul><h3>Global</h3><ul><li><a href="global.html#def">def</a></li><li><a href="global.html#isdef">isdef</a></li><li><a href="global.html#jstype">jstype</a></li><li><a href="global.html#seedRandom">seedRandom</a></li></ul></div><div class="category"><h2>DuGR</h2><h3>Namespaces</h3><ul><li><a href="DuGR.html">DuGR</a></li></ul></div><div class="category"><h2>DuIO</h2><h3>Namespaces</h3><ul><li><a href="DuIO.html">DuIO</a></li><li><a href="DuIO.Animation.html">Animation</a></li></ul></div><div class="category"><h2>DuOCA</h2><h3>Namespaces</h3><ul><li><a href="DuOCA.html">DuOCA</a></li></ul><h3>Classes</h3><ul><li><a href="DuOCADocument.html">DuOCADocument</a></li><li><a href="DuOCAFrame.html">DuOCAFrame</a></li><li><a href="DuOCALayer.html">DuOCALayer</a></li></ul></div><div class="category"><h2>DuSanity</h2><h3>Namespaces</h3><ul><li><a href="DuSanity.html">DuSanity</a></li><li><a href="DuSanity.Test.html">Test</a></li><li><a href="DuSanity.UI.html">UI</a></li></ul></div><div class="category"><h2>DuScriptUI</h2><h3>Namespaces</h3><ul><li><a href="DuScriptUI.html">DuScriptUI</a></li></ul><h3>Classes</h3><ul><li><a href="DuAECompSelector.html">DuAECompSelector</a></li><li><a href="DuAELayerPicker.html">DuAELayerPicker</a></li><li><a href="DuAELayerPickerDialog.html">DuAELayerPickerDialog</a></li><li><a href="DuAELayerSelector.html">DuAELayerSelector</a></li><li><a href="DuButton.html">DuButton</a></li><li><a href="DuCheckBox.html">DuCheckBox</a></li><li><a href="DuColorSelector.html">DuColorSelector</a></li><li><a href="DuEditText.html">DuEditText</a></li><li><a href="DuFileSelector.html">DuFileSelector</a></li><li><a href="DuFolderSelector.html">DuFolderSelector</a></li><li><a href="DuForm.html">DuForm</a></li><li><a href="DuLibrary.html">DuLibrary</a></li><li><a href="DuLibraryItem.html">DuLibraryItem</a></li><li><a href="DuListItem.html">DuListItem</a></li><li><a href="DuMultiButton.html">DuMultiButton</a></li><li><a href="DuPanel.html">DuPanel</a></li><li><a href="DuPopup.html">DuPopup</a></li><li><a href="DuProgressBar.html">DuProgressBar</a></li><li><a href="DuScriptPanel.html">DuScriptPanel</a></li><li><a href="DuSelector.html">DuSelector</a></li><li><a href="DuSeparator.html">DuSeparator</a></li><li><a href="DuSettingField.html">DuSettingField</a></li><li><a href="DuSlider.html">DuSlider</a></li><li><a href="DuSmallButton.html">DuSmallButton</a></li><li><a href="DuTab.html">DuTab</a></li><li><a href="DuTabPanel.html">DuTabPanel</a></li><li><a href="DuTitleBar.html">DuTitleBar</a></li><li><a href="DuToolBar.html">DuToolBar</a></li></ul></div><div class="category"><h2>Duik</h2><h3>Namespaces</h3><ul><li><a href="Duik.html">Duik</a></li><li><a href="Duik.Animation.html">Animation</a></li><li><a href="Duik.Automation.html">Automation</a></li><li><a href="Duik.Bone.html">Bone</a></li><li><a href="Duik.Camera.html">Camera</a></li><li><a href="Duik.CmdLib.html">CmdLib</a></li><li><a href="Duik.CmdLib.Duik.CmdLib%255B_Animation_%255D.html">Duik.CmdLib['Animation']</a></li><li><a href="Duik.Constraint.html">Constraint</a></li><li><a href="Duik.Controller.html">Controller</a></li><li><a href="Duik.Layer.html">Layer</a></li><li><a href="Duik.Pin.html">Pin</a></li><li><a href="Duik.Rig.html">Rig</a></li><li><a href="Duik.Tool.html">Tool</a></li></ul></div><div class="category"><h2>ExpressionLibrary</h2><h3>Classes</h3><ul><li><a href="DuAEExpression.Library._FuzzyLogic_.html">"FuzzyLogic"</a></li><li><a href="DuAEExpression.Library._FuzzyVeracity_.html">"FuzzyVeracity"</a></li><li><a href="DuAEExpression.Library._Matrix_.html">"Matrix"</a></li></ul></div><div class="category"><h2>OCO</h2><h3>Namespaces</h3><ul><li><a href="OCO.html">OCO</a></li></ul><h3>Classes</h3><ul><li><a href="OCOBone.html">OCOBone</a></li><li><a href="OCOConfig.html">OCOConfig</a></li><li><a href="OCODoc.html">OCODoc</a></li><li><a href="OCOLibrary.html">OCOLibrary</a></li><li><a href="OCOLimb.html">OCOLimb</a></li></ul></div><div class="category"><h2>fuzzy-search.jsxinc</h2><h3>Classes</h3><ul><li><a href="FuzzySearch.html">FuzzySearch</a></li></ul></div><div class="category"><h2>gettext.jsxinc</h2><h3>Namespaces</h3><ul><li><a href="translationEngine.html">translationEngine</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>DuIO_api.jsxinc</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// ==================== |-----| ====================
// ==================== | api | ====================
// ==================== |-----| ====================

// Include all Duik methods and DuAEF Extension

/**
 * &lt;h3>A collection of tools for exporting and importing stuff in After Effects&lt;/h3>
 * &lt;p>DuIO requires &lt;i>DuAEF&lt;/i>, the &lt;i>Duduf After Effects Framework&lt;/i>. Two builds of the &lt;i>DuIO API&lt;/i> are available:&lt;br />
 * &lt;ul>&lt;li>&lt;code>DuIO_api.jsxinc&lt;/code> does not include &lt;i>DuAEF&lt;/i>, and can be used to compine multiple &lt;i>Duduf APIs&lt;/i> with a single copy of &lt;i>DuAEF&lt;/i>.&lt;br />
 * Be careful to grab the right version of &lt;i>DuAEF&lt;/i> in this case.&lt;/li>
 * &lt;li>&lt;code>DuAEF_DuIO_api.jsxinc&lt;/code> includes all dependencies, with &lt;i>DuAEF&lt;/i>, and is easier to include in your scripts.&lt;/li>&lt;/ul>&lt;/p>
 * @example
 * // Encapsulate everything to avoid global variables!
 * // The parameter is either undefined (stand alone script) or the panel containing the ui (ScriptUI)
 * (function(thisObj)
 * {
 *      // If you only need Duik, just include DuAEF_Duik_api
 *      #include "DuAEF_DuIO_api.jsxinc";
 *      
 *      // Running the init() method of DuAEF is required to setup everything properly.
 *      DuAEF.init( "YourScriptName", "1.0.0", "YourCompanyName" );
 *      
 *      // These info can be used by the framework to improve UX, but they're optional
 *      DuESF.chatURL = 'http://chat.rxlab.info'; // A link to a live-chat server like Discord or Slack...
 *      DuESF.bugReportURL = 'https://github.com/RxLaboratory/DuAEF_Dugr/issues/new/choose'; // A link to a bug report form
 *      DuESF.featureRequestURL = 'https://github.com/RxLaboratory/DuAEF_Dugr/issues/new/choose'; // A link to a feature request form
 *      DuESF.aboutURL = 'http://rxlaboratory.org/tools/dugr'; // A link to the webpage about your script
 *      DuESF.docURL = 'http://dugr.rxlab.guide'; // A link to the documentation of the script
 *      DuESF.scriptAbout = 'Duduf Groups: group After Effects layers!'; // A short string describing your script
 *      DuESF.companyURL = 'https://rxlaboratory.org'; // A link to your company's website
 *      DuESF.rxVersionURL = 'http://version.rxlab.io' // A link to an RxVersion server to check for updates
 *      
 *      // Build your UI here, declare your methods, etc.
 * 
 *      // This will be our main panel
 *      var ui = DuScriptUI.scriptPanel( thisObj, true, true, new File($.fileName) );
 *      ui.addCommonSettings(); // Automatically adds the language settings, location of the settings file, etc
 *
 *      DuScriptUI.staticText( ui.settingsGroup, "Hello world of settings!" ); // Adds a static text to the settings panel
 *      DuScriptUI.staticText( ui.mainGroup, "Hello worlds!" ); // Adds a static text to the main panel
 *      
 *      // When you're ready to display everything
 *      DuScriptUI.showUI(ui);
 *
 *      // Note that if you don't have a UI or if you don't use DuScriptUI to show it,
 *      // you HAVE TO run this method before running any other function:
 *      // DuAEF.enterRunTime();
 *  
 * })(this);
 * @example
 * // Encapsulate everything to avoid global variables!
 * // The parameter is either undefined (stand alone script) or the panel containing the ui (ScriptUI)
 * (function(thisObj)
 * {
 *      // If you need to combine Duik and other APIs like DuIO or DuGR
 *      // Include DuAEF first, and then stand-alone APIs
 *      #include "DuAEF.jsxinc";
 *      #include "DuGR_api.jsxinc";
 *      #include "Duik_api.jsxinc";
 *      #include "DuIO_api.jsxinc";
 *      
 *      // Running the init() method of DuAEF is required to setup everything properly.
 *      DuAEF.init( "YourScriptName", "1.0.0", "YourCompanyName" );
 *      
 *      // These info can be used by the framework to improve UX, but they're optional
 *      DuESF.chatURL = 'http://chat.rxlab.info'; // A link to a live-chat server like Discord or Slack...
 *      DuESF.bugReportURL = 'https://github.com/RxLaboratory/DuAEF_Dugr/issues/new/choose'; // A link to a bug report form
 *      DuESF.featureRequestURL = 'https://github.com/RxLaboratory/DuAEF_Dugr/issues/new/choose'; // A link to a feature request form
 *      DuESF.aboutURL = 'http://rxlaboratory.org/tools/dugr'; // A link to the webpage about your script
 *      DuESF.docURL = 'http://dugr.rxlab.guide'; // A link to the documentation of the script
 *      DuESF.scriptAbout = 'Duduf Groups: group After Effects layers!'; // A short string describing your script
 *      DuESF.companyURL = 'https://rxlaboratory.org'; // A link to your company's website
 *      DuESF.rxVersionURL = 'http://version.rxlab.io' // A link to an RxVersion server to check for updates
 *      
 *      // Build your UI here, declare your methods, etc.
 * 
 *      // This will be our main panel
 *      var ui = DuScriptUI.scriptPanel( thisObj, true, true, new File($.fileName) );
 *      ui.addCommonSettings(); // Automatically adds the language settings, location of the settings file, etc
 *
 *      DuScriptUI.staticText( ui.settingsGroup, "Hello world of settings!" ); // Adds a static text to the settings panel
 *      DuScriptUI.staticText( ui.mainGroup, "Hello worlds!" ); // Adds a static text to the main panel
 *      
 *      // When you're ready to display everything
 *      DuScriptUI.showUI(ui);
 *
 *      // Note that if you don't have a UI or if you don't use DuScriptUI to show it,
 *      // you HAVE TO run this method before running any other function:
 *      // DuAEF.enterRunTime();
 *  
 * })(this);
 * @namespace
 * @author Nicolas Dufresne and contributors
 * @copyright 2008 - 2021 Nicolas Dufresne, RxLaboratory
 * @version 3.0.0
 * @requires DuAEF>=1.0.0
 * @category DuIO
 * @license GPL-3.0 &lt;br />
 * DuIO is free software: you can redistribute it and/or modify&lt;br />
 * it under the terms of the GNU General Public License as published by&lt;br />
 * the Free Software Foundation, either version 3 of the License, or&lt;br />
 * (at your option) any later version.&lt;br />
 *&lt;br />
 * DuIO is distributed in the hope that it will be useful,&lt;br />
 * but WITHOUT ANY WARRANTY; without even the implied warranty of&lt;br />
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&lt;br />
 * GNU General Public License for more details.&lt;br />
 *&lt;br />
 * You should have received a copy of the GNU General Public License&lt;br />
 * along with DuIO. If not, see {@link http://www.gnu.org/licenses/}.
 */
var DuIO = {};

// ==================== |---------| ====================
// ==================== | strings | ====================
// ==================== |---------| ====================

DuScriptUI.String.IMPORT_ANIMATION = "Import animation";// ==================== |-----------| ====================
// ==================== | animation | ====================
// ==================== |-----------| ====================

/**
 * Animation IO
 * @namespace
 * @category DuIO
 */
DuIO.Animation = {};


/**
 * Pastes the animation previously copied by {@link Duik.Animation.copy} to the selected properties.
 * @param {DuAELayerAnimation[]} data The animation data to paste
 * @param {CompItem} [comp] The composition.
 * @param {Boolean} [replace=false] - Whether to completely erase and replace the current animation
 * @param {Boolean} [offset=false] - Whether to offset the animation from the current value
 * @param {Boolean} [reverse=false] - Whether to reverse the animation
 * @param {string[]} [matchNames=[]] A filter to apply only on specific property types
 * @param {Boolean} [keyframesOnly=true] - If false, the value of properties without keyframes will be set too.
 * @param {Boolean} [expressions=false] - If true, the expression is set too.
 * @param {Boolean} [dontMoveAncestors=false] - When set to true, the transform (position, rotation) values for ancestor layers (the ones without parent) will be offset to 0 before applying the animation.
 */
DuIO.Animation.paste = function ( layers, data, replace, offset, reverse, matchNames, keyframesOnly, expressions, dontMoveAncestors )
{
	var comp = DuAEProject.getActiveComp();
	if (!comp) return;

    if (typeof layers === 'undefined')
	{
		layers = DuAEComp.getSelectedLayers();
		if (layers.length == 0) layers = comp.layers;
	}
	if (layers.length == 0) return;

    //options
    var time = comp.time;
	if (data.firstKeyFrameTime) time -= data.firstKeyFrameTime;
    replace = def( replace, false );
    offset = def( offset, false );
    reverse = def( reverse, false );
	matchNames = def(matchNames, []);
	keyframesOnly = def( keyframesOnly, true);
	expressions = def( expressions, !keyframesOnly);
	dontMoveAncestors = def(dontMoveAncestors, false);

    DuAE.beginUndoGroup(DuScriptUI.String.PASTE_KEYFRAMES, false);
    DuAEProject.setProgressMode(true);

    var remaining = DuAELayer.setAnims( layers, data, time, undefined, expressions, keyframesOnly, replace, matchNames, offset, reverse, dontMoveAncestors );

    if (remaining.length > 0)
    {
        var ui_pasteLayerPicker = DuScriptUI.layerPickerDialog("Missing layers");

        for (var i = 0, num = remaining.length; i &lt; num; i++)
        {
            ui_pasteLayerPicker.addSelector(remaining[i]._index + ' | ' + remaining[i]._name);
            //try to preselect by name
            var ok = false;
            for (var j = 1, numLayers = comp.numLayers; j &lt;= numLayers; j++)
            {
                var l = comp.layer(j);
                if (l.name.toLowerCase() == remaining[i]._name.toLowerCase())
                {
                    ui_pasteLayerPicker.layerPicker.selectors[i].setCurrentIndex(j);
                    ok = true;
                    break;
                }
            }
            if (!ok &amp;&amp; remaining[i]._index > 0 &amp;&amp; remaining[i]._index &lt;= comp.numLayers) ui_pasteLayerPicker.layerPicker.selectors[i].setCurrentIndex(remaining[i]._index);
        }

        ui_pasteLayerPicker.onAccept = function () {
            DuAE.beginUndoGroup(DuScriptUI.String.PASTE_KEYFRAMES, false);
            DuAEProject.setProgressMode(true);
            DuAELayer.setAllAnims(
                ui_pasteLayerPicker.getLayers(),
                remaining,
                time,
                undefined,
                expressions,
                keyframesOnly,
                replace,
                matchNames,
                offset,
                reverse
            );
            DuAEProject.setProgressMode(false);
            DuAE.endUndoGroup(DuScriptUI.String.PASTE_KEYFRAMES);
        };

        DuAEProject.setProgressMode(false);
        DuScriptUI.showUI(ui_pasteLayerPicker);
    }

    DuAEProject.setProgressMode(false);
    DuAE.endUndoGroup(DuScriptUI.String.PASTE_KEYFRAMES);

}

/**
 * Copies all the animations on selected layers, and saves them to a Json file.
 * @param {File} file The file to save the data
 * @param {Layer[]|DuList&lt;Layer>|LayerCollection} [layers] An array of Layers or LayerCollection with the animation. Selected layers from the current comp if omitted.
 * @param {Boolean} [selectedKeysOnly] Wether to copy only selected keys or not. If omitted, will be true if there are selected keyframes, false otherwise.
 * @return {DuAELayerAnimation[]} The animations
 */
DuIO.Animation.toJson = function( file, layers, selectedKeysOnly)
{
    layers = def( layers, DuAEComp.getSelectedLayers() );
    if (layers.length == 0) return null;
    var comp = layers[0].containingComp;

    //wether to store only selected keys if there are any
    selectedKeysOnly = def( selectedKeysOnly, DuAELayer.haveSelectedKeys(layers) );
    
    //end time of the animation to store
    var endTime = comp.workAreaDuration + comp.workAreaStart;
    //start time of the animation to store
    var startTime;
    // If there are selected keys, look for the time of the first one
    if (selectedKeysOnly) startTime = DuAELayer.firstKeyFrameTime(layers,true);
    else startTime = comp.workAreaStart;

    var data = {};
	data.duio = {};
	data.duio.version = DuESF.scriptVersion.fullVersion;
	data.duio.animation = true;
	data.duio.rig = false;

	//copy the animation
	var anims  = DuAELayer.getAnims( layers, selectedKeysOnly, [startTime, endTime] );
	//clean data
	data.layers = DuIO.Animation.cleanExportData(anims);

	//save data
	DuFile.saveJSON(data,file);

    return anims;
}

/**
 * Loads an animation file and applies it on the layers
 * @param {File} jsonFile The file containing the animation
 * @param {Layer[]|DuList&lt;Layer>|LayerCollection} [layers] The layers. If omitted, will get the selected layers from the current comp, or all layers if none are selected.
 * @param {Boolean} [keyframesOnly=false] If true, will load only keyframes, but not static values or expressions.
 * @param {string[]} [matchNames=[]] A filter for the properties to load. If empty, will load all properties.
 * @param {Boolean} [offset=false] Whether to offset the current values or use absolute values.
 * @param {Boolean} [reverse=false] Whether to reverse the keyframes in time.
 */
DuIO.Animation.fromJson = function( jsonFile, layers, keyframesOnly, matchNames, offset, reverse )
{
	if (!jsonFile.exists) return;
	
	keyframesOnly = def( keyframesOnly, false );

	DuAE.beginUndoGroup( DuScriptUI.String.IMPORT_ANIMATION, false );
	DuAEProject.setProgressMode(true);

	var data = DuFile.parseJSON( jsonFile );
	//TODO version check
	var anim = data.layers;
	//clean data
	anim  = DuIO.Animation.cleanImportData(anim);

	DuIO.Animation.paste( layers, anim, false, offset, reverse, matchNames, keyframesOnly, undefined, true );

	DuAEProject.setProgressMode(false);
	DuAE.endUndoGroup( DuScriptUI.String.IMPORT_ANIMATION );
}

/**
 * Cleans data from an After Effects animation before exporting it.&lt;br />
 * This is a low-level function which you may need only if building your own export formats.&lt;br />
 * It cleans the data returned by the "getAnim" functions  (see {@link DuAELayer.getAnim}, {@link DuAELayer.getAnims}, {@link DuAEProperty.getAnim}) to be able to store it in a text file.
 * @param {object}	data	The animation
 * @return {object}	The data cleaned
 */
DuIO.Animation.cleanExportData = function (data)
{
	var newData = data;
	if (newData.keys)
	{
		for (var k = 0, num =  newData.keys.length ; k &lt; num; k++)
		{
			newData.keys[k]._inInterpolationType = DuIO.Animation.keyframeInterpolationTypeToName(newData.keys[k]._inInterpolationType);
			newData.keys[k]._outInterpolationType = DuIO.Animation.keyframeInterpolationTypeToName(newData.keys[k]._outInterpolationType);
		}
	}
	if (newData.anims)
	{
		for (var a = 0, num =  newData.anims.length ; a &lt; num; a++)
		{
			newData.anims[a] = DuIO.Animation.cleanExportData(newData.anims[a]);
		}
	}
	if (newData instanceof Array)
	{
		for (var a = 0, num =  newData.length ; a &lt; num; a++)
		{
			newData[a] = DuIO.Animation.cleanExportData(newData[a]);
		}
	}

	return newData;
}

/**
 * Cleans data from a JSON before loading it.&lt;br />
 * This is a low-level function which you may need only if building your own import formats.&lt;br />
 * It cleans the data stored after having used {@link DuAEF.Interchange.animation.cleanAnimExportData}&lt;br />
 * to be able to set the animations using the "setAnim" functions (see {@link DuAEF.DuAE.Layer.setAnim}, {@link DuAEF.DuAE.Property.setAnim}).
 * @param {object}	data	The animation
 * @return {object}	The data cleaned
 */
DuIO.Animation.cleanImportData = function (data)
{
	var newData = data;
	if (newData.keys)
	{
		for (var k = 0, num =  newData.keys.length ; k &lt; num; k++)
		{
			newData.keys[k] = DuIO.Animation.cleanKeyframeImportData(newData.keys[k]);
		}
	}
	if (newData.anims)
	{
		for (var a = 0, num =  newData.anims.length ; a &lt; num; a++)
		{
			newData.anims[a] = DuIO.Animation.cleanImportData(newData.anims[a]);
		}
	}
	if (newData instanceof Array)
	{
		for (var a = 0, num =  newData.length ; a &lt; num; a++)
		{
			newData[a] = DuIO.Animation.cleanImportData(newData[a]);
		}
	}

	return newData;
}

/**
 * Cleans data from a JSON before loading it.&lt;br />
 * This is a low-level function which you may need only if building your own import formats.&lt;br />
 * It cleans the data stored after having used {@link DuAEF.Interchange.animation.cleanAnimExportData}&lt;br />
 * to be able to set the animations using the "setAnim" functions (see {@link DuAEF.DuAE.Layer.setAnim}, {@link DuAEF.DuAE.Property.setAnim}).
 * @memberof DuAEF.Interchange.animation
 * @param {object}	keyframeData	The keyframe data which is being loaded
 * @return {object}	The data cleaned
 */
DuIO.Animation.cleanKeyframeImportData = function (keyframeData)
{
	var newData = keyframeData;
	newData._inInterpolationType = DuIO.Animation.keyframeInterpolationNameToType(newData._inInterpolationType);
	newData._outInterpolationType = DuIO.Animation.keyframeInterpolationNameToType(newData._outInterpolationType);
	for (var i = 0, num = newData.inEase.length; i &lt; num; i++)
	{
		var inInfluence = newData.inEase[i].influence;
		if (inInfluence &lt; 0.1) inInfluence = 0.1;
		if (inInfluence > 100) inInfluence = 100;
		var outInfluence = newData.outEase[i].influence;
		if (outInfluence &lt; 0.1) outInfluence = 0.1;
		if (outInfluence > 100) outInfluence = 100;
		newData.inEase[i] = new KeyframeEase(newData.inEase[i].speed, inInfluence);
		newData.outEase[i] = new KeyframeEase(newData.outEase[i].speed, outInfluence);
	}

	// If the value is a path
	if (typeof newData.value.vertices !== 'undefined')
	{
		var s = new Shape();
		var v = newData.value;
		s.closed = v.closed;
		s.featherInterps = v.featherInterps;
		s.featherRadii = v.featherRadii;
		s.featherRelCornerAngles = v.featherRelCornerAngles;
		s.featherRelSegLocs = v.featherRelSegLocs;
		s.featherSegLocs = v.featherSegLocs;
		s.featherTensions = v.featherTensions;
		s.featherTypes = v.featherTypes;
		s.inTangents = v.inTangents;
		s.outTangents = v.outTangents;
		s.vertices = v.vertices;
		newData.value = s;
	}

	return newData;
}

/**
 * Gets the name of an After Effects interpolation type.&lt;br />
 * This is a low-level function which you should not need.&lt;br />
 * It used by {@link DuIO.Animation.cleanAnimExportData} to store interpolation with their names.
 * @param {KeyframeInterpolationType}	type	The After Effects interpolation type
 * @return {string}	The interpolation name or empty string if not found
 */
DuIO.Animation.keyframeInterpolationTypeToName = function (type)
{
	if (type == KeyframeInterpolationType.LINEAR) return 'linear';
	if (type == KeyframeInterpolationType.BEZIER) return 'bezier';
	if (type == KeyframeInterpolationType.HOLD) return 'hold';
	else return '';
}

/**
 * Gets the After Effects interpolation type with its name.&lt;br />
 * This is a low-level function which you should not need.&lt;br />
 * It used by {@link DuAEF.Interchange.cleanAnimImportData} to set interpolation from their names.
 * @memberof DuAEF.Interchange.animation
 * @param {string}	name	The interpolation name
 * @return {KeyframeInterpolationType}	The interpolation type or null if not found
 */
DuIO.Animation.keyframeInterpolationNameToType = function (name)
{
	if (!name) return KeyframeInterpolationType.LINEAR;
	name = name.toString();
	if (name.toLowerCase() == 'linear' || name == '6612') return KeyframeInterpolationType.LINEAR;
	else if (name.toLowerCase() == 'bezier' || name == '6613') return KeyframeInterpolationType.BEZIER;
	else if (name.toLowerCase() == 'hold' || name == '6614') return KeyframeInterpolationType.HOLD;
	else return null;
}
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>


</body>
</html>
